<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GC Garage – Fiche de contrôles</title>
<link rel="manifest" href="manifest.json">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js');
  });
}
</script>
<style>
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:#e5e7eb;background:linear-gradient(45deg,rgba(0,0,0,.35)25%,rgba(0,0,0,0)25%,rgba(0,0,0,0)75%,rgba(0,0,0,.35)75%),linear-gradient(45deg,rgba(0,0,0,.35)25%,rgba(0,0,0,0)25%,rgba(0,0,0,0)75%,rgba(0,0,0,.35)75%);background-color:#0b0f16;background-size:22px 22px;background-position:0 0,11px 11px}
:root{--red:#ef233c;--dark:#0f172a;--panel:#0f172aef;--stroke:#1f2937}
header{padding:10px 16px;background:linear-gradient(180deg,#111827ee,#0b1220cc);display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #1f2937}
h1{margin:0;font-size:18px;color:#fff;letter-spacing:.3px}
#logoImg{height:46px;border-radius:8px;background:#0b1220;padding:4px;border:1px solid #243041;display:none}
main{max-width:1100px;margin:16px auto;padding:0 16px 60px}
.card{background:var(--panel);border:1px solid var(--stroke);border-radius:12px;padding:16px;margin-top:14px}
.grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
label{font-size:12px;color:#9aa3b2;margin-bottom:6px;display:block}
input,textarea,button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a3442;background:#0b1220;color:#e5e7eb}
textarea{min-height:84px;resize:vertical}
button{cursor:pointer}
button.primary{background:var(--red);border-color:#b91c1c;font-weight:600}
button.warn{background:#7c2d12;border-color:#9a3412}
.section{margin-top:8px;border:1px solid #293241;border-radius:12px;overflow:hidden}
.section>.head{background:linear-gradient(90deg,rgba(239,35,60,.18),transparent);padding:10px 12px;display:flex;align-items:center;justify-content:space-between}
.section h3{margin:0;font-size:14px;letter-spacing:.3px}
table{width:100%;border-collapse:collapse}
th,td{border-top:1px solid #273142;padding:8px 10px;text-align:left}
th{font-size:12px;color:#cbd5e1;background:#0e1626}
@media print{body{background:#fff;color:#000}header,button{display:none}#logoImg{display:inline-block !important}}
</style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:12px">
    <img id="logoImg" alt="Logo GC Garage">
    <h1>GC Garage — Fiche de contrôles</h1>
  </div>
  <div style="display:flex;gap:8px;align-items:center">
    <label for="logoFile" style="font-size:12px;cursor:pointer;color:#93c5fd">Importer logo</label>
    <input id="logoFile" type="file" accept="image/*" style="display:none">
    <button id="clearLogoBtn" style="font-size:12px">Effacer</button>
  </div>
</header>

<main>
  <div class="card">
    <div class="grid">
      <div><label>Nom / Société</label><input id="clientName" placeholder="Client"></div>
      <div><label>Email</label><input id="clientEmail" placeholder="client@mail.fr"></div>
      <div><label>Véhicule</label><input id="vehicule" placeholder="Marque / Modèle"></div>
      <div><label>Immatriculation</label><input id="immat" placeholder="AA-123-BB"></div>
      <div><label>Kilométrage</label><input id="km" type="number" placeholder="128450"></div>
      <div><label>Date</label><input id="date" type="date"></div>
    </div>
    <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="primary" id="saveBtn">Enregistrer</button>
      <button id="newBtn">Nouveau</button>
      <input id="searchImmat" placeholder="Rechercher immat" style="max-width:160px">
      <button id="searchBtn">Charger</button>
      <button id="printBtn">PDF</button>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 8px;color:#fff">FICHE DE CONTRÔLES</h2>
    <div id="sections"></div>
    <div class="section" style="margin-top:14px">
      <div class="head"><h3>Observations</h3></div>
      <div style="padding:10px">
        <textarea id="observations" placeholder="Remarques générales..."></textarea>
      </div>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 style="margin:0;color:#fff">Pièces prises / référencées</h2>
      <div>
        <button id="addPart">+ Ajouter</button>
        <button class="warn" id="clearParts">Vider</button>
      </div>
    </div>
    <div class="section" style="margin-top:8px">
      <table id="partsTable">
        <thead><tr><th>Référence</th><th>Désignation</th><th>Qté</th><th>Action</th></tr></thead>
        <tbody id="partsBody"></tbody>
      </table>
    </div>
  </div>
</main>

<script>
const LOGOKEY='garage_logo_gc';const DBKEY='garage_fiches_gc';
const CATEGORIES=[["VISIBILITÉ",["Balais essuie-glace","Pare-brise","Rétroviseurs"]],["ÉCLAIRAGE",["Feux croisement","Feux stop","Clignotants","Antibrouillard"]],["NIVEAUX",["Huile moteur","Liquide frein","Refroidissement"]],["FREINAGE",["Plaquettes","Disques","Témoin niveau frein"]]];
const $=s=>document.querySelector(s);
function el(t,a={},...c){const e=document.createElement(t);for(const[k,v]of Object.entries(a))k.startsWith("on")?e.addEventListener(k.slice(2),v):e.setAttribute(k,v);c.forEach(x=>x!=null&&e.appendChild(typeof x==="string"?document.createTextNode(x):x));return e;}
const sectionsWrap=$("#sections");const stateMap={};
function key(c,i){return c+"|"+i;}
function render(){sectionsWrap.innerHTML="";CATEGORIES.forEach(([cat,items])=>{const sec=el("div",{class:"section"},el("div",{class:"head"},el("h3",{},cat)),el("table",{},el("thead",{},el("tr",{},el("th",{},"Contrôle"),el("th",{},"Bon"),el("th",{},"À faire"))),el("tbody",{},...items.map(it=>{const k=key(cat,it);const ok=el("input",{type:"radio",name:k,onchange:()=>stateMap[k]="ok"});const bad=el("input",{type:"radio",name:k,onchange:()=>stateMap[k]="bad"});return el("tr",{},el("td",{},it),el("td",{},ok),el("td",{},bad));})))));sectionsWrap.appendChild(sec);});}
render();
const partsBody=$("#partsBody");
function addPart(r="",d="",q="1"){const tr=el("tr",{},el("td",{},el("input",{value:r,placeholder:"Réf"})),el("td",{},el("input",{value:d,placeholder:"Désignation"})),el("td",{},el("input",{value:q,type:"number",min:"0"})),el("td",{},el("button",{onclick:()=>tr.remove()},"Suppr")));partsBody.appendChild(tr);}
$("#addPart").onclick=()=>addPart();$("#clearParts").onclick=()=>partsBody.innerHTML="";
function loadLogo(){const u=localStorage.getItem(LOGOKEY);if(u){$("#logoImg").src=u;$("#logoImg").style.display="block";}}
$("#logoFile").addEventListener("change",e=>{const f=e.target.files?.[0];if(!f)return;const r=new FileReader();r.onload=()=>{localStorage.setItem(LOGOKEY,r.result);loadLogo();};r.readAsDataURL(f);});
$("#clearLogoBtn").onclick=()=>{localStorage.removeItem(LOGOKEY);$("#logoImg").style.display="none";}
function collect(){const parts=Array.from(partsBody.querySelectorAll("tr")).map(tr=>{const i=tr.querySelectorAll("input");return{ref:i[0].value,label:i[1].value,qte:i[2].value};});return{client:$("#clientName").value,email:$("#clientEmail").value,vehicule:$("#vehicule").value,immat:$("#immat").value.toUpperCase(),km:$("#km").value,date:$("#date").value,obs:$("#observations").value,checks:stateMap,parts};}
function save(){const d=collect();if(!d.immat){alert("Immat requise");return;}const db=JSON.parse(localStorage.getItem(DBKEY)||"{}");db[d.immat]=d;localStorage.setItem(DBKEY,JSON.stringify(db));alert("Fiche enregistrée");}
function search(){const key=($("#searchImmat").value||"").toUpperCase();const db=JSON.parse(localStorage.getItem(DBKEY)||"{}");if(db[key])fill(db[key]);else alert("Aucune fiche trouvée");}
function fill(d){$("#clientName").value=d.client;$("#clientEmail").value=d.email;$("#vehicule").value=d.vehicule;$("#immat").value=d.immat;$("#km").value=d.km;$("#date").value=d.date;$("#observations").value=d.obs;partsBody.innerHTML="";(d.parts||[]).forEach(p=>addPart(p.ref,p.label,p.qte));Object.assign(stateMap,d.checks||{});render();}
$("#saveBtn").onclick=save;$("#searchBtn").onclick=search;$("#printBtn").onclick=()=>window.print();$("#newBtn").onclick=()=>location.reload();loadLogo();addPart();
</script>
</body>
</html>
